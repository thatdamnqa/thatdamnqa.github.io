<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Daniel Shaw" /></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Daniel Shaw</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <a class="page-link" href="/">Blog</a><a class="page-link" href="/portfolio">Portfolio</a><a class="page-link" href="/speaking">Speaking</a></div>
      </nav><p class="site-description">Software QA. I also develop things at the weekend.</p>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h2>Using PHP composer with multiple versions of PHP
        </h2>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
        <p>This problem has hurt me a few times while updating this (Drupal) website, so I’m mostly posting this braindump for myself. But, it might help somebody else.</p>

<p>The main cause of my problem is I commit composer’s /vendor directory into git. (Why do I do this? <a href="https://www.codeenigma.com/build/blog/do-you-really-need-composer-production">Here’s an article which explains better than I could on why you may want to commit the vendor directory</a>. In short, I find it more helpful to have all the code in git, for easier deployment. But, I may change my mind in the future, given these recent problems I’ve been having).</p>

<p>Anyway. My computer (which I use to update Drupal for my site) runs php 7.1, and my server is still running php 7.0. This causes problems in terms of dependencies, when composer assumes I’ll be using php 7.1, so I inevitably get code errors.</p>

<p>I solved this problem by adding a few lines to my composer.json:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"config": {
  "sort-packages": true,
    "platform": {
        "php": "7.0"
    }
  },
</code></pre></div></div>

<p>Which worked fine, until a dependency update meant I didn’t have the correct php version. This caused composer to update to an older version of Drupal (Drupal 8.4.8 rather than Drupal 8.5.3), and this output when I forced composer to update to Drupal 8.5.x:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem 1
    - drupal/core 8.6.x-dev requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.x-dev requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.3 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.2 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.1 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.0-rc1 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.0-beta1 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.0-alpha1 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - drupal/core 8.5.0 requires php ^5.5.9|&gt;=7.0.8 -&gt; your PHP version (7.1.7) overridden by "config.platform.php" version (7.0) does not satisfy that requirement.
    - Installation request for drupal/core ~8.5 -&gt; satisfiable by drupal/core[8.5.0, 8.5.0-alpha1, 8.5.0-beta1, 8.5.0-rc1, 8.5.1, 8.5.2, 8.5.3, 8.5.x-dev, 8.6.x-dev]. (As a side-note, my initial reaction was to try `composer update  --with-dependencies --ignore-platform-reqs`, which worked, but of course meant that composer wasn't downloading dependencies for php 7.0, which is what I wanted).
</code></pre></div></div>

<p>Turns out, as I had php 7.0.30 installed on my server, I could just update my composer.json to update the platform tag, and do a regular <code class="highlighter-rouge">composer update</code>. Which did the job, for now. I’ll inevitably need to update my server to php 7.2, eventually.</p>

<p><strong>So, tl;dr, there’s two things I need to remember:</strong></p>

<ul>
  <li>If I commit my composer vendor folder, I need to <strong>ensure that both my work computer and my server have exactly the same version of php on both machines</strong></li>
  <li>If not, then to ensure code works properly, I need to add a platform tag into my composer.json file, ensuring it is accurate, including fix bug versions. And remember <strong>never to use <code class="highlighter-rouge">--ignore-platform-reqs</code></strong>. It will mean that composer will update, but to the wrong version.</li>
</ul>

    </div><div class="post-meta"><p>Jun 4, 2018 &middot; <a href="/blog/2018-06/using-composer-with-multiple-versions-of-php">Permalink</a></p></div>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>
      <div class="social-links"><ul class="social-media-list"><li><a href="https://github.com/thatdamnqa" title="thatdamnqa"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a href="https://twitter.com/thatdamnqa" title="thatdamnqa"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li><li><a href="/feed.xml" title="RSS"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg></a></li>
</ul>
</div>
  </div>
</footer>
</body>

</html>
